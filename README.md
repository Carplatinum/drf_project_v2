# Django LMS Project

Система управления обучением (LMS), разработанная с использованием Django и Django REST Framework.

## О проекте

Данный проект представляет собой платформу для управления курсами и уроками с поддержкой регистрации пользователей, их аутентификации через JWT и разграничением прав доступа. В проекте реализованы функции управления курсами, уроками и платежами пользователей.

## Особенности

- Кастомная модель пользователя с правами доступа
- Создание, редактирование и просмотр курсов и уроков
- JWT аутентификация с расширенным токеном
- Разграничение прав доступа для владельцев, модераторов и обычных пользователей
- Загрузка и хранение медиа (превью курсов и уроков)
- Управление платежами и история оплат
- REST API для фронтенда

## Технологии

- Python 3.13
- Django 4.x
- Django REST Framework
- PostgreSQL
- rest_framework_simplejwt для JWT аутентификации
- python-dotenv для работы с переменными окружения
- Poetry для управления зависимостями и виртуальным окружением

## Установка и локальный запуск

1. Клонируйте репозиторий:
git clone https://github.com/Carplatinum/drf_project_v2

2. Перейдите в каталог проекта:
cd drf_project

3. Настройте и активируйте виртуальное окружение с Poetry (рекомендуется):

- Включите создание виртуального окружения в папке `.venv` внутри проекта:
  ```
  poetry config virtualenvs.in-project true
  ```

- Установите зависимости и создайте виртуальное окружение:
  ```
  poetry install
  ```

- Активируйте виртуальное окружение:
  ```
  poetry shell
  ```

- При необходимости выберите версию Python:
  ```
  poetry env use python3.13
  ```

4. Создайте файл `.env` на основе `.env.sample` с вашими переменными окружения.
5. Выполните миграции:
python manage.py migrate

6. Запустите сервер разработки:
python manage.py runserver

## Использование API

- Регистрация пользователя: `POST /users/register/`
- Получение JWT токена: `POST /users/token/`
- Операции с курсами: эндпоинт `/courses/`
- Операции с уроками: эндпоинт `/lessons/`
- Платежи: эндпоинт `/payments/`

# Запуск проекта через Docker Compose

## 1. Подготовка
- Скопируйте шаблон `.env.example` в `.env` и заполните значения.
- Убедитесь, что `.env` содержит правильные значения для подключения к базам и сервисам.

## 2. Запуск проекта

   docker-compose up --build

Эта команда соберёт контейнеры и запустит все сервисы вместе.

## 3. Проверка работы сервисов
- Backend Django будет доступен по адресу: http://localhost:8000/
- PostgreSQL слушает порт 5432
- Redis слушает порт 6379
- Celery и Celery Beat запускаются и выполняют задачи (логи видны в терминале)

## 4. Остановка контейнеров

   docker-compose down
   
## Развертывание на удаленном сервере
- Убедитесь, что сервер оснащён Docker и Docker Compose.

- Перед деплоем остановите системный nginx, чтобы избежать конфликтов на порту 80:

sudo systemctl stop nginx
sudo systemctl disable nginx
- Настройте SSH-доступ к серверу, используемый в GitHub Actions для деплоя.

Процесс деплоя автоматизирован и запускается из GitHub Actions при пуше в ветку main.

В CI/CD настроено:

- Запуск тестов и миграций

- Линтинг

- Сборка и публикация Docker-образов

- Автоматический деплой на сервер

- Управление контейнерами на сервере:

docker compose ps
docker compose logs <service_name>
docker compose down
docker compose up -d --build
- Адрес сервера с развернутым приложением
http://158.160.204.190:8080

* Обратите внимание, что использован порт 8080 из-за конфликта системного порта 80.

### Настройка CI/CD
Файл workflow находится в .github/workflows/ci-cd.yml и включает:

- Тесты на изолированной среде с Postgres и Redis

- Кеширование pip-зависимостей для ускорения

- Публикацию Docker образов на Docker Hub

- Деплой на удалённый сервер через SSH с управлением контейнерами

Для корректной работы необходимо:

- Заполнить секреты GitHub для Docker Hub и SSH доступа

- Убедиться в доступе сервера по SSH и правильной конфигурации Docker

- Следить за стабильностью и успешностью сборок и деплоя

Лицензия
MIT License

